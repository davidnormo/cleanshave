var escapeHTML=function(input){if(typeof input!=="string")return input;return input.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/["]/g,"&quot;").replace(/'/g,"&#039;")};var resolveKey=function(stack,path){var key="",result="";stackLoop:for(var j=0;j<stack.length;j++){var target=stack[j];pathLoop:for(var i=0;i<path.length;i++){key=path[i];target=target[key];if(target===undefined){break pathLoop}}if(target!==undefined&&typeof target!=="object")return target}return""};var getObjectValue=function(stack,starting,dotted){if(starting===".")return stack.pop();if(!dotted.length)return resolveKey(stack,[""+starting]);var path=[starting];for(var i=0;i<dotted.length;i++){path.push(dotted[i])}return resolveKey(stack,path)};var processSection=function(data,vars,parentEl,contextStack){var key=vars.section;var context=data[key];if(vars.dotted.length){key=vars.dotted[vars.dotted.length-1];context=vars.dotted.reduce(function(ctx,key){return ctx[key]?ctx[key]:[]},context)}contextStack=contextStack||[];if(!(context instanceof Array)){contextStack.unshift(context)}if(context===false)return;var iterateVariables=function(obj,variables){variables.forEach(function(variable){if(typeof variable!=="object"){parentEl.appendChild(that[variable].cloneNode(true))}else{if(variable.section!==undefined){var innerSection=variable.section;var innerFrag=document.createDocumentFragment();processSection(data,that[innerSection],innerFrag,contextStack);contextStack.shift();parentEl.appendChild(innerFrag)}else{var method=Object.keys(variable)[0],contextData=contextStack.length?contextStack:[obj],text=escapeHTML(getObjectValue(contextData,variable[method],variable.dotted));parentEl.appendChild(document.createTextNode(text))}}})};var iterate=function(obj,recursively){recursively=recursively===undefined?false:recursively;if(recursively){iterateVariables(obj,vars.inner)}else{obj.forEach(function(item){iterateVariables(item,vars.inner)})}};if(typeof context==="object"&&!(context instanceof Array)){iterate(context,true)}else if(context instanceof Array){iterate(context)}else if(context==true){iterate([data])}};